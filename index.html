<script>
        // PASTIKAN SEMUA KODE DIJALANKAN HANYA SETELAH HTML SELESAI DIBUAT
        document.addEventListener('DOMContentLoaded', () => {

            const giftBox = document.getElementById('giftBox');
            const messageModal = document.getElementById('messageModal');
            const animatedTextDiv = document.getElementById('animatedText');
            const photoContainer = document.getElementById('photoContainer');
            const surpriseMusic = document.getElementById('surpriseMusic'); 

            // Hapus fungsi playMusic() yang lama (kita akan masukkan logikanya langsung ke listener)
            // const playMusic = () => { ... } // Hapus ini

            const messageLines = [
                "Dibilang sayangg? aku sayangg bangettt sayangg poll sama kamuu.aku suka semua tentang kamu aku suka kalo kamu marahin akuu‚ aku juga suka bgtt kalo dapett notif dari kamu, notif kamu adalah hal yg paling indah aku tunggu. pokoknya aku suka semuanya tentang kamuu, kamu ga perlu takut aku menghilang dari kamu, karna aku ga bakal ninggalin kamu di keadaan apapun.",
                "Kamu adalah orang yg selalu aku pikirkan sebelum tidurr sampe bangun tidur,hmm ga ngerti lagi gimana cara bilangnya, gini lah aku, seorang diri yg memiliki segala kekurangan namun nekat mencintaimu, aku gabilang kalo aku yg terbaik, cuman aku bakal berusaha untuk jadii yg terbaik buat kamu.",
                "Kamu butuh tempat cerita? sini cerita ke aku kalo kamu lebih milih memendem semuanya justru aku ngerasa gagal ada aku, kalo kamu ga cerita ke aku kamu mau cerita ke siapa? aku bakal nemenin kamu walaupun kamu lagi diposisi terendah dalam hidup kamu aku ga peduli walaupun diri aku sebenarnya juga lagi knpa-knpa. Aku tak sabar untuk menciptakan lebih banyak kenangan indah bersamamu di masa depan.",
                "Yang jelas aku mau nemenin kamu disaat kamu lagi gabaik baik aja aku sayang sama kamu, aku cinta sama kamu aku nyaman sama kamu,maaf kalo aku sering marah sama kamu, maaf aku suka ngerepotin kamu, maaf kalo aku sering overthinking.",
                "Kalo ada masalah selesaiin masalah nya sayangg jangan hubungan nya.apapun masalahnya kita selesaiin baik-baik u never know how much love u and i really lucky for having you. ❤️", 
            ];

            let lineIndex = 0;
            let isTyping = false;
            let musicPlayed = false;

            function stopMusic() {
                surpriseMusic.pause();
                surpriseMusic.currentTime = 0; 
                musicPlayed = false;
            }

            function typeMessage() {
                if (isTyping) return;

                if (lineIndex >= messageLines.length) {
                    setTimeout(() => {
                        photoContainer.classList.add('visible');
                    }, 500); 
                    return;
                }

                isTyping = true;
                const lineText = messageLines[lineIndex];
                
                const newLine = document.createElement('p');
                newLine.innerHTML = `<span class="message-line"></span>`;
                animatedTextDiv.appendChild(newLine);
                
                animatedTextDiv.scrollTop = animatedTextDiv.scrollHeight;

                const span = newLine.querySelector('.message-line');
                let charIndex = 0;
                
                const typing = setInterval(() => {
                    if (charIndex < lineText.length) {
                        span.textContent += lineText.charAt(charIndex);
                        charIndex++;
                    } else {
                        clearInterval(typing);
                        isTyping = false;
                        lineIndex++;
                        setTimeout(typeMessage, 1200); 
                    }
                }, 100); 
            }

            // PERBAIKAN TOTAL DI SINI
            giftBox.addEventListener('click', () => {
                if (messageModal.classList.contains('active')) return; 
                
                giftBox.classList.add('opened');
                
                // LOGIKA AUDIO (Muted Autoplay Bypass)
                if (!musicPlayed) {
                    surpriseMusic.currentTime = 0; 
                    surpriseMusic.volume = 0.5;
                    // 1. Mute audio agar perintah play diizinkan
                    surpriseMusic.muted = true; 
                    
                    surpriseMusic.play()
                        .then(() => {
                            // 2. Setelah berhasil play (diam), UNMUTE
                            setTimeout(() => {
                                surpriseMusic.muted = false; 
                                musicPlayed = true;
                                console.log("✅ Musik berhasil diputar dan di-unmute."); 
                            }, 50); 
                        })
                        .catch(error => {
                            console.error("❌ Kegagalan total memutar audio:", error.message);
                            alert("Gagal memutar audio! Silakan coba di browser lain.");
                            musicPlayed = true;
                        });
                }
                
                setTimeout(() => {
                    messageModal.classList.add('active');
                    photoContainer.classList.remove('visible'); 
                    typeMessage();
                }, 500); 
            });

            function closeModal() {
                messageModal.classList.remove('active');
                stopMusic(); 
                
                setTimeout(() => {
                    giftBox.classList.remove('opened');
                    animatedTextDiv.innerHTML = ''; 
                    photoContainer.classList.remove('visible'); 
                    lineIndex = 0; 
                    isTyping = false;
                }, 500); 
            }

            messageModal.addEventListener('click', (event) => {
                if (event.target === messageModal) {
                    closeModal();
                }
            });

        }); // Tutup dari DOMContentLoaded
    </script>
